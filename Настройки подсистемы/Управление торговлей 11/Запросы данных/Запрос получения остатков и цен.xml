<FixedStructure xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="FixedStructure">
	<Property name="Ключ">
		<Value xmlns:d3p1="http://v8.1c.ru/8.1/data/enterprise/current-config" xsi:type="d3p1:ConstantValueKey.SUI_ЗапросПолученияОстатковИЦен"/>
	</Property>
	<Property name="Данные">
		<Value xsi:type="Structure">
			<Property name="ДанныеКонструктора">
				<Value xsi:type="FixedStructure">
					<Property name="ТекстЗапроса">
						<Value xsi:type="xs:string">ВЫБРАТЬ
	ВидыЦен.Ссылка КАК ВидЦены,
	ВЫБОР
		КОГДА ВидыЦен.Идентификатор = "Розничная"
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК Розничная,
	ВЫБОР
		КОГДА ВидыЦен.Идентификатор = "Оптовая"
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК Оптовая
ПОМЕСТИТЬ втВидыЦен
ИЗ
	Справочник.ВидыЦен КАК ВидыЦен
ГДЕ
	ВидыЦен.Идентификатор В ("Розничная", "Оптовая")
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ЦеныНоменклатурыСрезПоследних.Номенклатура КАК Номенклатура,
	ЦеныНоменклатурыСрезПоследних.Характеристика КАК Характеристика,
	ЦеныРозничные.Цена КАК ЦенаРозничная,
	ЦеныОптовые.Цена КАК ЦенаОптовая
ПОМЕСТИТЬ втЦены
ИЗ
	РегистрСведений.ЦеныНоменклатуры.СрезПоследних(
			,
			Номенклатура = &amp;Номенклатура
				И ВЫБОР
					КОГДА &amp;Характеристика = НЕОПРЕДЕЛЕНО
						ТОГДА ИСТИНА
					ИНАЧЕ Характеристика = &amp;Характеристика
				КОНЕЦ
				И ВидЦены В
					(ВЫБРАТЬ
						втВидыЦен.ВидЦены
					ИЗ
						втВидыЦен)) КАК ЦеныНоменклатурыСрезПоследних
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры.СрезПоследних(
				,
				Номенклатура = &amp;Номенклатура
					И ВЫБОР
						КОГДА &amp;Характеристика = НЕОПРЕДЕЛЕНО
							ТОГДА ИСТИНА
						ИНАЧЕ Характеристика = &amp;Характеристика
					КОНЕЦ
					И ВидЦены В
						(ВЫБРАТЬ
							втВидыЦен.ВидЦены
						ИЗ
							втВидыЦен
						ГДЕ
							втВидыЦен.Розничная)) КАК ЦеныРозничные
		ПО ЦеныНоменклатурыСрезПоследних.Номенклатура = ЦеныРозничные.Номенклатура
			И ЦеныНоменклатурыСрезПоследних.Характеристика = ЦеныРозничные.Характеристика
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры.СрезПоследних(
				,
				Номенклатура = &amp;Номенклатура
					И ВЫБОР
						КОГДА &amp;Характеристика = НЕОПРЕДЕЛЕНО
							ТОГДА ИСТИНА
						ИНАЧЕ Характеристика = &amp;Характеристика
					КОНЕЦ
					И ВидЦены В
						(ВЫБРАТЬ
							втВидыЦен.ВидЦены
						ИЗ
							втВидыЦен
						ГДЕ
							втВидыЦен.Оптовая)) КАК ЦеныОптовые
		ПО ЦеныНоменклатурыСрезПоследних.Номенклатура = ЦеныОптовые.Номенклатура
			И ЦеныНоменклатурыСрезПоследних.Характеристика = ЦеныОптовые.Характеристика
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ втВидыЦен
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТоварыНаСкладахОстатки.Номенклатура КАК Номенклатура,
	ТоварыНаСкладахОстатки.Характеристика КАК Характеристика,
	ТоварыНаСкладахОстатки.Склад КАК Склад,
	СУММА(ТоварыНаСкладахОстатки.ВНаличииОстаток) КАК Остаток
ПОМЕСТИТЬ втОстатки
ИЗ
	РегистрНакопления.ТоварыНаСкладах.Остатки(
			,
			Номенклатура = &amp;Номенклатура
				И ВЫБОР
					КОГДА &amp;Характеристика = НЕОПРЕДЕЛЕНО
						ТОГДА ИСТИНА
					ИНАЧЕ Характеристика = &amp;Характеристика
				КОНЕЦ) КАК ТоварыНаСкладахОстатки

СГРУППИРОВАТЬ ПО
	ТоварыНаСкладахОстатки.Номенклатура,
	ТоварыНаСкладахОстатки.Характеристика,
	ТоварыНаСкладахОстатки.Склад
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЕСТЬNULL(втОстатки.Номенклатура, втЦены.Номенклатура) КАК id_good,
	ЕСТЬNULL(втОстатки.Номенклатура.Наименование, втЦены.Номенклатура.Наименование) КАК good_name,
	ЕСТЬNULL(втОстатки.Номенклатура.Артикул, втЦены.Номенклатура.Артикул) КАК article,
	ЕСТЬNULL(втОстатки.Характеристика, втЦены.Характеристика) КАК id_property,
	ЕСТЬNULL(втОстатки.Характеристика.Наименование, втЦены.Характеристика.Наименование) КАК property_name,
	ЕСТЬNULL(втОстатки.Склад.Наименование, "") КАК purpose,
	ЕСТЬNULL(втОстатки.Остаток, 0) КАК qtty,
	ЕСТЬNULL(втЦены.ЦенаРозничная, 0) КАК price_new,
	ЕСТЬNULL(втЦены.ЦенаОптовая, 0) КАК price_old,
	ЕСТЬNULL(втОстатки.Номенклатура.Артикул, ЕСТЬNULL(втЦены.Номенклатура.Артикул, "")) + " / " + ЕСТЬNULL(втОстатки.Характеристика.Наименование, ЕСТЬNULL(втЦены.Характеристика.Наименование, "")) КАК representation
ИЗ
	втОстатки КАК втОстатки
		ПОЛНОЕ СОЕДИНЕНИЕ втЦены КАК втЦены
		ПО втОстатки.Номенклатура = втЦены.Номенклатура
			И втОстатки.Характеристика = втЦены.Характеристика</Value>
					</Property>
					<Property name="ВыполнятьВПакетномРежиме">
						<Value xsi:type="xs:boolean">false</Value>
					</Property>
					<Property name="ПакетыРезультата">
						<Value xsi:type="Array"/>
					</Property>
				</Value>
			</Property>
		</Value>
	</Property>
</FixedStructure>